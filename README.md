# eecho

ターミナル上で日本語を入力すると、即座に英語へ翻訳するCLIツール

(簡単な日本語などの翻訳に適しています。難しい文の翻訳ではかなり性能に劣ります)

## 特徴

- **ゼロセットアップ**: `npm install -g eecho` だけで即利用可能
- **完全オフライン動作**: 初回実行後はインターネット不要
- **プライバシー重視**: すべての処理がローカルマシン上で完結
- **クロスプラットフォーム**: macOS、Linux、Windowsで動作
- **高速**: ONNX最適化モデルで素早い翻訳
- **静かな出力**: デフォルトは翻訳結果のみ表示。`--verbose` で詳細ログも確認可能
- **バックグラウンドキャッシュ**: 初回に翻訳ワーカーをspawnし、以降はモデルを常駐させて高速応答

## インストール

```bash
npm install -g eecho
```

## 使い方

### 初回実行

初回実行時のみ、翻訳モデル（約300MB）を自動ダウンロードします。デフォルトでは翻訳結果だけが表示されます：

```bash
eecho こんにちは
# Hello
```

進捗などの詳細ログを確認したい場合は `--verbose` を付けます：

```bash
eecho --verbose こんにちは
# Downloading model... 45% (model.onnx)
# ...
# Model ready!
# Hello
```

### 2回目以降

2回目以降は即座に翻訳されます：

```bash
eecho こんにちは
# Hello
```

### 使用例

```bash
# 基本的な翻訳
eecho こんにちは
# 出力: Hello

# 長文の翻訳
eecho "今日はいい天気ですね"
# 出力: It's nice weather today

# パイプから入力
echo "ありがとうございます" | eecho
# 出力: Thank you very much

# 複数の単語
eecho お疲れ様でした
# 出力: Good work
```

### オプション

```bash
eecho --help     # ヘルプを表示
eecho --version  # バージョンを表示
eecho --shutdown-worker  # バックグラウンドワーカーを停止
eecho --verbose  # モデル進捗や各種ログを表示
EECHO_VERBOSE=1 eecho こんにちは  # 常に詳細ログを有効化
```

#### バックグラウンドワーカーについて

初回実行時に `eecho` は翻訳専用の Node プロセスをバックグラウンドで起動し、`/tmp/eecho-worker`（`EECHO_WORKER_DIR` で変更可）にリクエストキューを作成します。以降の起動はこのワーカーにキューを投入するだけなので、ONNX の詳細ログは吸収され、訳文だけが表示されます。ワーカーを停止したい場合は `eecho --shutdown-worker` を実行してください。次回の翻訳リクエスト時に自動的に再生成されます。

## 動作原理

1. **初回実行**: Helsinki-NLPのopus-mt-ja-enモデル（ONNX最適化版、約300MB）をダウンロード
2. **日本語検出**: ひらがな・カタカナ・漢字を含むテキストを検出
3. **翻訳実行**: ローカルのtransformerモデルで翻訳（初回以降はインターネット不要）
4. **結果表示**: ターミナルに翻訳結果を表示

## 必要環境

- Node.js >= 18.0.0
- ディスク容量 約500MB（モデルキャッシュ用）
- インターネット接続（初回実行時のみ）

### プロジェクト構造

```
eecho/
├── src/
│   ├── entry/          # CLIエントリポイント
│   ├── core/           # 翻訳パイプライン
│   ├── providers/      # 翻訳エンジン（transformers）
│   ├── services/       # サービス層（設定など）
│   └── utils/          # ヘルパー（日本語検出など）
├── package.json
└── tsconfig.json
```

## パフォーマンス

- **初回実行**: 約10〜30秒（モデルダウンロード + 初期化）
- **2回目以降**: 1文あたり約1〜3秒
- **モデルサイズ**: 約300MB（`~/.cache/huggingface/`にキャッシュ）
- **メモリ使用量**: 翻訳中約200〜400MB

